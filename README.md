# JavaWeb项目作业

## 项目：简易论坛

## 成员

姓名|学号|分工
---|---|---
李沛尧|1712901|后端、数据库设计，协助开发前端|
杨添凯|1712950|前端设计|
曹续生|1712872|后端、数据库设计，协助开发前端|

## 项目注意事项

* `Eclipse`新建项目时，勾选`Dynamic Web`项目，项目名称为`JavaWeb`，项目路径选中该文件上层目录，next两下后，还会有一个`Content directory`的名称要填，默认是WebContent，**改成web**，之后Finish就完事了。
* `Jetbrains`新建项目时，大概和上边一样，另外需要针对servlet项目配置，[见连接](https://blog.csdn.net/yhao2014/article/details/45740111)

最好大家都用JetBrains吧，不然容易出问题是真的。。。

## 项目应实现功能

### 必要功能：

1. 用户组支持

   * `visitor`访客级别：只能够查看、搜索帖子和回复，不能发表帖子，不能回复其他用户
   * `user`普通用户级别：拥有上一级用户所有权限，且可以发表帖子，可以回复其他用户，可以删除自己发表的帖子、回复
   * `operator`普通管理员级别：拥有上一级用户所有权限，且可以删除`user`用户及自己发表的帖子、回复，可以封禁用户
   * `admin`网站管理员级别：只能由一个用户，拥有上一级用户所有权限，且可以删除所有用户的帖子和回复，可以发放剥夺普通管理员身份

2. 发帖、回复

    * `user`及以上权限的用户可以发帖，帖子信息应该有以下基本信息：

        * 发布者id
        * 发布日期
        * 帖子标题
        * 主题内容（类似百度贴吧，标题下有描述）
    
    * `user`及以上权限的用户可以回复其他用户的主题贴，也可以回复其他用户的回复，回复内容应该包含以下基本信息

        * 发布者id
        * 发布日期
        * 具体内容

3. 搜索功能

    * 按照用户名、用户id搜索内容：搜索用户名或id后可以跳转到个人主页。
    * 按照关键字搜索：可以返回一个带有文本关键字内容信息的列表（类似知乎手机端搜索）

4. 删除功能

    * 帖子删除：直接级联删除所有信息，直接不可见
    * 回复删除：普通用户仅删除该回复，不做级联删除。管理员可以级联删除。

5. 个人中心功能（前端部分）

    * 要显示个人用户信息，时间线（类似知乎）

6. 排行榜功能（该部分主要参考[北邮人](https://bt.byr.cn/topten.php)的设计）

    * 发帖总数统计
    * 注册用户总数统计
    * 注册时间统计
    * 单个用户的发帖数排行
    * 单个用户的回复数排行
    * 单个用户的注册时间排行

### 次要功能（可支持）

1. 回复内容的富文本标记（好像有现成的富文本模块）：emoji、图片、格式

2. 用户社交丰富化：好友功能、关注功能、关注用户的时间线实现

## 数据库设计

### 数据库实体定义

* `user`表定义，用户基本信息

|字段|类型|描述|默认值|是否主键|外键约束|非空约束|
|:----:|:---:|:----:|:------:|:--------:|:---:|:--:|
|`id`|`INT`|用户UID，自增长字段|无默认值|是|无|`not null`|
|`nickname`|`VARCHAR(45)`|用户昵称|`null`|否|无||
|`password`|`VARCHAR(50)`|用户密码|无默认值|否|无|`not null`|
|`profile_photo_url`|`VARCHAR(50)`|用户头像url|`null`|否|无|
|`registered_date`|`DATE`|用户注册时间|无|否|无|`not null`|
|`type`|`VARCHAR(10)`|用户组类型|"user"|否|无|`not null`|

* `post`表定义，帖子基本信息

|字段|类型|描述|默认值|是否主键|外键约束|非空约束|
|:----:|:---:|:----:|:------:|:--------:|:---:|:--:|
|`post_id`|`INT`|帖子UID，自增长|无|是|无|`not null`|
|`user_id`|`INT`|发帖人id|无|否|`user.id`|`not null`|
|`post_name`|`VARCHAR(100)`|帖子title|无|否|无|`not null`|
|`content`|`TEXT`|帖子描述|无|否|无|`not null`|
|`post_time`|`DATE`|发帖时间|无|否|无|`not null`|

* `floor`表定义，直接回复`post`的楼层

|字段|类型|描述|默认值|是否主键|外键约束|非空约束|
|:----:|:---:|:----:|:------:|:--------:|:---:|:--:|
|`floor_id`|`INT`|楼层唯一UID，自增长|无|是|无|`not null`|
|`floor_num`|`INT`|楼层号|无|否|无|`not null`|
|`parent_post_id`|`INT`|父级帖子id|无|否|`post.post_id`|`not null`|
|`user_id`|`INT`|楼层发表人id|无|否|`user.user_id`|`not null`|
|`floor_contnet`|`TEXT`|楼层内容|无|否|无|`not null`|
|`floor_time`|`TEXT`|楼层创建时间|无|否|无|`not null`|
* `comment`表定义，回复`floor`的评论

|字段|类型|描述|默认值|是否主键|外键约束|非空约束|
|:----:|:---:|:----:|:------:|:--------:|:---:|:--:|
|`comment_id`|`INT`|评论唯一表示UID，自增长|无|是|无|`not null`|
|`user_id`|`INT`|评论发布者id|无|否|`user.user_id`|`not null`|
|`root_floor_id`|`INT`|根楼层UID，因为一个评论可以回复其他评论，那么应该表示出它的楼层UID|无|否|`floor.floor_id`|`not null`|
|`pre_comment_id`|`INT`|回复上一级回复的id，如果直接回复`floor`则为-1|`-1`|否|无|not null|
|`content`|`TEXT`|回复内容|无|否|无|`not null`|
|`comment_time`|`DATE`|评论时间|无|否|无|`not null`|
|`isdeleted`|`TINYINT`|是否删除|`1`|否|无|`not null`|

### 数据库函数设计
